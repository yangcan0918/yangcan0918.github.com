<!doctype html>
<html class="theme-next use-motion">
<head>
  

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>




  <link rel="stylesheet" type="text/css" href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>


<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.3.0rc2"/>


    <meta name="description" content="本博客主要用来记录linux相关的文章" />





    <link rel="shorticon icon" type="image/x-icon" href="/favicon.ico?v=0.3.0rc2" />



  <title> 恢复rm删除文件 // linux运维学习与交流中心 </title>
</head>

<body>
  <div class="container one-column page-post-detail">
    <div class="headband"></div>

    <div id="header" class="header">
      <div class="header-inner">
        <h1 class="site-meta">
    <a href="/" class="brand">
        <span class="logo">
          <i class="icon-logo"></i>
        </span>
        <span class="site-title">linux运维学习与交流中心</span>
    </a>
</h1>


  <ul id="menu" class="menu">
    
      
      <li class="menu-item menu-item-home">
        <a href="/">
          <i class="menu-item-icon icon-home"></i> <br />
          Home
        </a>
      </li>
    
      
      <li class="menu-item menu-item-archives">
        <a href="/archives">
          <i class="menu-item-icon icon-archives"></i> <br />
          Archives
        </a>
      </li>
    
      
      <li class="menu-item menu-item-tags">
        <a href="/tags">
          <i class="menu-item-icon icon-tags"></i> <br />
          Tags
        </a>
      </li>
    
  </ul>


      </div>
    </div>

    <div id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          
            
          

          <div id="posts" class="posts-expand">
            
  

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              恢复rm删除文件
            
          
        </h1>
      

      <div class="post-meta">
          <span class="post-time">
            
              Posted on 2015-01-16
            
          </span>
        
          
        
      </div>
    </div>

    
      <div class="post-body">

        
        

        
          <p>手太快，肠子都毁清了。本来是删除一个文件 rm path/myfile.txt<br>结果不知为何加了个<em>，变成了<br>rm path/myfile.txt </em><br>赶紧ls，发现所有代码都化为了乌有，还没提交，还没备份。删除时还不确认。一秒钟，世界就清净了。<br>带着侥幸的心情四处寻找，并无一处压缩包备份。有一些备份的地方也是很早期的工作。<br>欲哭无泪。<br>所以linux的rm删除时不先备份，真是要不得。难怪很多人rm时左看右看得过个半分钟才敢下手。有人建议直接将root下的rm改成mv的别名。<br>没办法，必须恢复。<br>机器在机房里，也不能断电拔硬盘或者重启。<br><a id="more"></a></p>
<h3 id="首先，需立即将磁盘挂载为只读。">首先，需立即将磁盘挂载为只读。</h3>
<p>否则其他daemons 都来读写，神仙都恢复不了了。磁盘规划时一定要做功能分区。否则，误删了想恢复也很困难。比如linux安装时不分区整个装/下面，就很麻烦。</p>
<h4 id="/data挂在/dev/sdb1上">/data挂在/dev/sdb1上</h4>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@hs12 sh]# mount</div><div class="line">/dev/sdb1 on /<span class="typedef"><span class="keyword">data</span> <span class="keyword">type</span> ext4 <span class="container">(<span class="title">rw</span>)</span></span></div><div class="line">[root@hs12 hadoop]# mount -r -n -o remount /<span class="typedef"><span class="keyword">data</span></span></div><div class="line"><span class="title">mount</span>: /<span class="typedef"><span class="keyword">data</span> is busy</span></div></pre></td></tr></table></figure>

<h4 id="这需看看有哪些进程在用：">这需看看有哪些进程在用：</h4>
<pre><code>[root<span class="variable">@hs12</span> hadoop]<span class="comment"># fuser -v -m /data</span>
</code></pre><h4 id="可以看到有很多java和hadoop进程在使用，杀之。">可以看到有很多java和hadoop进程在使用，杀之。</h4>
<pre><code>[root<span class="variable">@hs12</span> hadoop]<span class="comment"># mount -r -n -o remount /data</span>
</code></pre><p>成功。</p>
<h4 id="再到/data里touch文件，报错。">再到/data里touch文件，报错。</h4>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root<span class="variable">@hs12</span> data]<span class="comment"># touch a</span></div><div class="line">touch: cannot touch <span class="string">`a’: Read-only file system</span></div></pre></td></tr></table></figure>

<p>一下就放轻松了很多。因为改为只读挂载后，可以慢慢恢复，再也不用担心我的文件被覆盖。</p>
<h3 id="使用debugfs">使用debugfs</h3>
<h4 id="用debugfs查找被删文件的inode，再想法恢复。">用debugfs查找被删文件的inode，再想法恢复。</h4>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@hs12 ~]<span class="preprocessor"># debugfs /dev/sdb1</span></div><div class="line">debugfs <span class="number">1.41</span><span class="number">.12</span> (<span class="number">17</span>-May-<span class="number">2010</span>)</div><div class="line"><span class="label">debugfs:</span></div><div class="line"><span class="label">debugfs:</span> lsdel</div><div class="line">Inode Owner Mode Size Blocks Time deleted</div><div class="line"><span class="number">0</span> deleted inodes found.</div></pre></td></tr></table></figure>

<p>神奇的debugfs 根本没找到有文件被删除的inodes，难道是我不会用？<br>失败！</p>
<h3 id="使用grep恢复">使用grep恢复</h3>
<p>grep 在磁盘二进制中查找文本，把前后的字符导出来，也许可以恢复部分。<br>    [root@hs12 hadoop]# grep -a -B 100 -A 100 ‘active.sh’ /dev/sdb1 &gt; results.txt<br>只有一些乱七八糟的二进制。<br>失败！</p>
<h3 id="使用ext3grep">使用ext3grep</h3>
<p>我的是ext4系统，根本不起作用。</p>
<p>只好寻找专业工具</p>
<h3 id="用testdisk_6-14">用testdisk 6.14</h3>
<h4 id="使用介绍：">使用介绍：</h4>
<pre><code><span class="label">http:</span>//www.cgsecurity<span class="preprocessor">.org</span>/wiki/TestDisk%<span class="number">3</span>a_undelete_file_for_ext2
</code></pre><h4 id="下载：">下载：</h4>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wget http:<span class="comment">//www.cgsecurity.org/testdisk-6.14.linux26-x86_64.tar.bz2</span></div></pre></td></tr></table></figure>

<h4 id="执行命令">执行命令</h4>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">[root@hs12 hadoop]# cd testdisk-<span class="number">6.14</span></div><div class="line">[root@hs12 testdisk-<span class="number">6.14</span>]# ls</div><div class="line">Android.mk ChangeLog documentation.html fidentify_static INFO l photorec<span class="number">.8</span> README testdisk<span class="number">.8</span> testdisk_static VERSION</div><div class="line">AUTHORS COPYING fidentify<span class="number">.8</span> ico jni NEWS photorec_static readme.txt testdisk.log THANKS</div><div class="line">[root@hs12 testdisk-<span class="number">6.14</span>]# ./testdisk_static</div><div class="line">TestDisk <span class="number">6.14</span>, Data Recovery Utility, July <span class="number">2013</span></div><div class="line">Christophe GRENIER &lt;grenier@cgsecurity.org&gt;</div><div class="line">http://www.cgsecurity.org</div><div class="line"><span class="number">1</span> P MS Data <span class="number">2048</span> <span class="number">7811889151</span> <span class="number">7811887104</span> [primary]</div><div class="line">Directory /</div><div class="line">&gt;drwxr-xr-x <span class="number">500</span> <span class="number">500</span> <span class="number">4096</span> <span class="number">28</span>-Aug-<span class="number">2013</span> <span class="number">13</span>:<span class="number">41</span> .</div><div class="line">drwxr-xr-x <span class="number">500</span> <span class="number">500</span> <span class="number">4096</span> <span class="number">28</span>-Aug-<span class="number">2013</span> <span class="number">13</span>:<span class="number">41</span> ..</div><div class="line">drwxrwxrwx <span class="number">500</span> <span class="number">500</span> <span class="number">16384</span> <span class="number">18</span>-Jul-<span class="number">2013</span> <span class="number">15</span>:<span class="number">42</span> lost+found</div><div class="line">drwxrwxrwx <span class="number">500</span> <span class="number">500</span> <span class="number">12288</span> <span class="number">12</span>-Sep-<span class="number">2013</span> <span class="number">00</span>:<span class="number">36</span> logs</div><div class="line">drwxrwxrwx <span class="number">500</span> <span class="number">500</span> <span class="number">4096</span> <span class="number">25</span>-Jul-<span class="number">2013</span> <span class="number">16</span>:<span class="number">54</span> test1</div><div class="line">drwxrwxr-x <span class="number">500</span> <span class="number">500</span> <span class="number">4096</span> <span class="number">12</span>-Sep-<span class="number">2013</span> <span class="number">03</span>:<span class="number">28</span> statis</div><div class="line">drwxrwxr-x <span class="number">500</span> <span class="number">500</span> <span class="number">4096</span> <span class="number">12</span>-Sep-<span class="number">2013</span> <span class="number">17</span>:<span class="number">40</span> sh</div><div class="line">drwxrwxr-x <span class="number">500</span> <span class="number">500</span> <span class="number">12288</span> <span class="number">3</span>-Sep-<span class="number">2013</span> <span class="number">15</span>:<span class="number">28</span> hadoop</div><div class="line"><span class="keyword">Next</span></div><div class="line"><span class="keyword">Use</span> Right <span class="keyword">to</span> change directory, h <span class="keyword">to</span> hide deleted files</div><div class="line">q <span class="keyword">to</span> quit, : <span class="keyword">to</span> <span class="keyword">select</span> the current <span class="keyword">file</span>, a <span class="keyword">to</span> <span class="keyword">select</span> <span class="keyword">all</span> files</div><div class="line">C <span class="keyword">to</span> copy the selected files, c <span class="keyword">to</span> copy the current <span class="keyword">file</span></div></pre></td></tr></table></figure>

<h4 id="选到相应目录，enter，终于看到了删除的文件名，但是文件大小怎么都是0啊？">选到相应目录，enter，终于看到了删除的文件名，但是文件大小怎么都是0啊？</h4>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line">TestDisk 6.14, Data Recovery Utility, July 2013</div><div class="line">Christophe GRENIER &lt;grenier@cgsecurity.org&gt;</div><div class="line">http://www.cgsecurity.org</div><div class="line">1 P MS Data 2048 7811889151 7811887104 [primary]</div><div class="line">Directory /sh</div><div class="line">drwxrwxr-x 500 500 4096 12-Sep-2013 17:40 .</div><div class="line">drwxr-xr-x 500 500 4096 28-Aug-2013 13:41 ..</div><div class="line">&gt;-rwxrwxr-x 500 500 0 12-Sep-2013 17:40 active.awk</div><div class="line">-<span class="ruby">rwxrwxr-x <span class="number">500</span> <span class="number">500</span> <span class="number">0</span> <span class="number">12</span>-<span class="constant">Sep</span>-<span class="number">2013</span> <span class="number">17</span><span class="symbol">:</span><span class="number">40</span> active.sh</span></div><div class="line">lrwxrwxrwx 500 500 13 2-Aug-2013 17:17 statis</div><div class="line">-<span class="ruby">rwxrwxr-x <span class="number">500</span> <span class="number">500</span> <span class="number">0</span> <span class="number">12</span>-<span class="constant">Sep</span>-<span class="number">2013</span> <span class="number">17</span><span class="symbol">:</span><span class="number">40</span> dateutil.sh</span></div><div class="line">-<span class="ruby">rwxrwxr-x <span class="number">500</span> <span class="number">500</span> <span class="number">0</span> <span class="number">12</span>-<span class="constant">Sep</span>-<span class="number">2013</span> <span class="number">17</span><span class="symbol">:</span><span class="number">40</span> hiveput.sh</span></div><div class="line">-<span class="ruby">rwxrwxr-x <span class="number">500</span> <span class="number">500</span> <span class="number">0</span> <span class="number">12</span>-<span class="constant">Sep</span>-<span class="number">2013</span> <span class="number">17</span><span class="symbol">:</span><span class="number">40</span> multidate.sh</span></div><div class="line">drwxrwxr-x 500 500 4096 3-Sep-2013 15:24 errlogs</div><div class="line">-<span class="ruby">rwxrwxr-x <span class="number">500</span> <span class="number">500</span> <span class="number">0</span> <span class="number">12</span>-<span class="constant">Sep</span>-<span class="number">2013</span> <span class="number">17</span><span class="symbol">:</span><span class="number">40</span> hiveactive.sh</span></div><div class="line">drwxrwxr-x 500 500 4096 12-Sep-2013 17:40 cps</div><div class="line">drwxrwxr-x 500 500 4096 30-Aug-2013 15:21 TempStatsStore</div><div class="line">-<span class="ruby">rwxrwxr-x <span class="number">500</span> <span class="number">500</span> <span class="number">0</span> <span class="number">12</span>-<span class="constant">Sep</span>-<span class="number">2013</span> <span class="number">17</span><span class="symbol">:</span><span class="number">40</span> bkactive.awk</span></div><div class="line">-<span class="ruby">rwxrwxr-x <span class="number">500</span> <span class="number">500</span> <span class="number">0</span> <span class="number">12</span>-<span class="constant">Sep</span>-<span class="number">2013</span> <span class="number">17</span><span class="symbol">:</span><span class="number">40</span> test.awk</span></div><div class="line">-<span class="ruby">rwxrwxr-x <span class="number">500</span> <span class="number">500</span> <span class="number">0</span> <span class="number">12</span>-<span class="constant">Sep</span>-<span class="number">2013</span> <span class="number">17</span><span class="symbol">:</span><span class="number">40</span> t.awk</span></div><div class="line">-<span class="ruby">rwxrwxr-x <span class="number">500</span> <span class="number">500</span> <span class="number">0</span> <span class="number">12</span>-<span class="constant">Sep</span>-<span class="number">2013</span> <span class="number">17</span><span class="symbol">:</span><span class="number">40</span> print</span></div><div class="line">-<span class="ruby">rw-rw-r– <span class="number">500</span> <span class="number">500</span> <span class="number">0</span> <span class="number">12</span>-<span class="constant">Sep</span>-<span class="number">2013</span> <span class="number">17</span><span class="symbol">:</span><span class="number">40</span> a</span></div><div class="line">-<span class="ruby">rw-rw-r– <span class="number">500</span> <span class="number">500</span> <span class="number">0</span> <span class="number">12</span>-<span class="constant">Sep</span>-<span class="number">2013</span> <span class="number">17</span><span class="symbol">:</span><span class="number">40</span> a.txt</span></div><div class="line">-<span class="ruby">rwxrwxr-x <span class="number">500</span> <span class="number">500</span> <span class="number">0</span> <span class="number">12</span>-<span class="constant">Sep</span>-<span class="number">2013</span> <span class="number">17</span><span class="symbol">:</span><span class="number">40</span> user.awk</span></div><div class="line">-<span class="ruby">rw-rw-r– <span class="number">500</span> <span class="number">500</span> <span class="number">0</span> <span class="number">12</span>-<span class="constant">Sep</span>-<span class="number">2013</span> <span class="number">17</span><span class="symbol">:</span><span class="number">40</span> luan</span></div><div class="line">-<span class="ruby">rwxrwxr-x <span class="number">500</span> <span class="number">500</span> <span class="number">0</span> <span class="number">12</span>-<span class="constant">Sep</span>-<span class="number">2013</span> <span class="number">17</span><span class="symbol">:</span><span class="number">40</span> cps.sh</span></div><div class="line">-<span class="ruby">rwxrwxr-x <span class="number">500</span> <span class="number">500</span> <span class="number">0</span> <span class="number">12</span>-<span class="constant">Sep</span>-<span class="number">2013</span> <span class="number">17</span><span class="symbol">:</span><span class="number">40</span> hivenewdev.sh</span></div><div class="line">-<span class="ruby">rw-rw-r– <span class="number">500</span> <span class="number">500</span> <span class="number">0</span> <span class="number">12</span>-<span class="constant">Sep</span>-<span class="number">2013</span> <span class="number">17</span><span class="symbol">:</span><span class="number">40</span> hive2mysql.sh</span></div><div class="line">-<span class="ruby">rw-rw-r– <span class="number">500</span> <span class="number">500</span> <span class="number">0</span> <span class="number">12</span>-<span class="constant">Sep</span>-<span class="number">2013</span> <span class="number">17</span><span class="symbol">:</span><span class="number">40</span> py</span></div><div class="line">lrwxrwxrwx 500 500 12 26-Aug-2013 09:34 userdata</div><div class="line">lrwxrwxrwx 500 500 10 26-Aug-2013 09:34 bidata</div><div class="line">-<span class="ruby">rwxrwxr-x <span class="number">500</span> <span class="number">500</span> <span class="number">0</span> <span class="number">12</span>-<span class="constant">Sep</span>-<span class="number">2013</span> <span class="number">17</span><span class="symbol">:</span><span class="number">40</span> bi.awk</span></div><div class="line">-<span class="ruby">rw-r–r– <span class="number">500</span> <span class="number">500</span> <span class="number">0</span> <span class="number">12</span>-<span class="constant">Sep</span>-<span class="number">2013</span> <span class="number">17</span><span class="symbol">:</span><span class="number">40</span> luandoutang_09_900037.csv</span></div><div class="line">-<span class="ruby">rw-rw-r– <span class="number">500</span> <span class="number">500</span> <span class="number">0</span> <span class="number">12</span>-<span class="constant">Sep</span>-<span class="number">2013</span> <span class="number">17</span><span class="symbol">:</span><span class="number">40</span> luan1</span></div><div class="line">-<span class="ruby">rwxr-xr-x <span class="number">500</span> <span class="number">500</span> <span class="number">0</span> <span class="number">12</span>-<span class="constant">Sep</span>-<span class="number">2013</span> <span class="number">17</span><span class="symbol">:</span><span class="number">40</span> luan.awk</span></div><div class="line">-<span class="ruby">rwxr-xr-x <span class="number">500</span> <span class="number">500</span> <span class="number">0</span> <span class="number">12</span>-<span class="constant">Sep</span>-<span class="number">2013</span> <span class="number">17</span><span class="symbol">:</span><span class="number">40</span> luan.sh</span></div><div class="line">-<span class="ruby">rwxrwxr-x <span class="number">500</span> <span class="number">500</span> <span class="number">0</span> <span class="number">12</span>-<span class="constant">Sep</span>-<span class="number">2013</span> <span class="number">17</span><span class="symbol">:</span><span class="number">40</span> dvid_price.awk</span></div><div class="line">-<span class="ruby">rwxrwxr-x <span class="number">500</span> <span class="number">500</span> <span class="number">0</span> <span class="number">12</span>-<span class="constant">Sep</span>-<span class="number">2013</span> <span class="number">17</span><span class="symbol">:</span><span class="number">40</span> cid_price.awk</span></div><div class="line">lrwxrwxrwx 500 500 15 9-Sep-2013 13:33 adsdkdata</div><div class="line">-<span class="ruby">rw-rw-r– <span class="number">500</span> <span class="number">500</span> <span class="number">0</span> <span class="number">12</span>-<span class="constant">Sep</span>-<span class="number">2013</span> <span class="number">17</span><span class="symbol">:</span><span class="number">40</span> 0908.txt</span></div><div class="line">-<span class="ruby">rw-rw-r– <span class="number">500</span> <span class="number">500</span> <span class="number">0</span> <span class="number">12</span>-<span class="constant">Sep</span>-<span class="number">2013</span> <span class="number">17</span><span class="symbol">:</span><span class="number">40</span> 09081.txt</span></div><div class="line">-<span class="ruby">rw-rw-r– <span class="number">500</span> <span class="number">500</span> <span class="number">0</span> <span class="number">12</span>-<span class="constant">Sep</span>-<span class="number">2013</span> <span class="number">17</span><span class="symbol">:</span><span class="number">40</span> 09.txt</span></div><div class="line">drwxrwxr-x 500 500 4096 9-Sep-2013 16:22 pid</div><div class="line">TestDisk 6.14, Data Recovery Utility, July 2013</div><div class="line">Please select a destination where /sh/active.awk will be copied.</div><div class="line">Keys: Arrow keys to select another directory</div><div class="line">C when the destination is correct</div><div class="line">Q to quit</div></pre></td></tr></table></figure>

<p>用a 选择所有文件，C 备份，选一个备份到的目录，确认。<br>进去一看，文件名都恢复了，但文件内容都是空的。号称能恢复ext4的testdisk恢复失败。<br>又下了新版testdisk-7.0-WIP.linux26-x86_64.tar.bz2，一样的问题。</p>
<h3 id="用extundelete-0-2-4恢复">用extundelete-0.2.4恢复</h3>
<h4 id="官方网站：">官方网站：</h4>
<pre><code>http:<span class="comment">//extundelete.sourceforge.net/</span>
</code></pre><h4 id="下载：-1">下载：</h4>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div></pre></td><td class="code"><pre><div class="line">    wget http://downloads.sourceforge.net/project/extundelete/extundelete/0.2.4/extundelete-0.2.4.tar.bz2</div><div class="line">extundelete依赖e2fsprogs</div><div class="line">[root@hs12 extundelete-0.2.4]# ./configure</div><div class="line">Configuring extundelete 0.2.4</div><div class="line">configure: error: Can’t find ext2fs library</div><div class="line">[root@hs12 extundelete-0.2.4]# yum <span class="operator"><span class="keyword">install</span> e2fsprogs-devel</span></div><div class="line">[root@hs12 extundelete-<span class="number">0.2</span><span class="number">.4</span>]# ./configure</div><div class="line">Configuring extundelete <span class="number">0.2</span><span class="number">.4</span></div><div class="line">Writing generated files <span class="keyword">to</span> disk</div><div class="line">[root@hs12 extundelete-<span class="number">0.2</span><span class="number">.4</span>]# make & make <span class="keyword">install</span></div><div class="line">[root@hs12 extundelete-<span class="number">0.2</span><span class="number">.4</span>]# cd src</div><div class="line">[root@hs12 src]# ls</div><div class="line">block.c cli.cc extundelete-block.o extundelete-cli.o extundelete.h extundelete-priv.h jfs_compat.h Makefile Makefile.<span class="keyword">in</span></div><div class="line">block.h extundelete extundelete.cc extundelete-extundelete.o extundelete-insertionops.o insertionops.cc kernel-jbd.h Makefile.am</div><div class="line">[root@hs12 src]# ./extundelete</div><div class="line"><span class="keyword">No</span> <span class="keyword">action</span> specified; implying –superblock.</div><div class="line">./extundelete: Missing device name.</div><div class="line">Usage: ./extundelete [options] [<span class="comment">--] device-file</span></div><div class="line">Options:</div><div class="line">–version, -[vV] Print version and exit successfully.</div><div class="line">–<span class="operator"><span class="keyword">help</span>, Print this <span class="keyword">help</span> <span class="keyword">and</span> exit successfully.</span></div><div class="line">–superblock Print contents <span class="keyword">of</span> superblock <span class="keyword">in</span> addition <span class="keyword">to</span> the rest.</div><div class="line"><span class="keyword">If</span> <span class="keyword">no</span> <span class="keyword">action</span> <span class="keyword">is</span> specified <span class="keyword">then</span> this <span class="keyword">option</span> <span class="keyword">is</span> implied.</div><div class="line">–journal <span class="keyword">Show</span> content <span class="keyword">of</span> journal.</div><div class="line">–<span class="keyword">after</span> dtime <span class="keyword">Only</span> process entries deleted <span class="keyword">on</span> <span class="keyword">or</span> <span class="keyword">after</span> ‘dtime’.</div><div class="line">–<span class="keyword">before</span> dtime <span class="keyword">Only</span> process entries deleted <span class="keyword">before</span> ‘dtime’.</div><div class="line">Actions:</div><div class="line">–inode ino <span class="keyword">Show</span> info <span class="keyword">on</span> inode ‘ino’.</div><div class="line">–block blk <span class="keyword">Show</span> info <span class="keyword">on</span> block ‘blk’.</div><div class="line">–<span class="keyword">restore</span>-inode ino[,ino,...]</div><div class="line"><span class="keyword">Restore</span> the file(s) <span class="keyword">with</span> known inode <span class="built_in">number</span> ‘ino’.</div><div class="line">The restored files <span class="keyword">are</span> created <span class="keyword">in</span> ./RECOVERED_FILES</div><div class="line"><span class="keyword">with</span> their inode <span class="built_in">number</span> <span class="keyword">as</span> extension (ie, file<span class="number">.12345</span>).</div><div class="line">–<span class="keyword">restore</span>-file ‘path’ Will <span class="keyword">restore</span> file ‘path’. ‘path’ <span class="keyword">is</span> <span class="keyword">relative</span> <span class="keyword">to</span> root</div><div class="line"><span class="keyword">of</span> the <span class="keyword">partition</span> <span class="keyword">and</span> does <span class="keyword">not</span> <span class="keyword">start</span> <span class="keyword">with</span> a ‘/’</div><div class="line">The restored file <span class="keyword">is</span> created <span class="keyword">in</span> the <span class="keyword">current</span></div><div class="line">directory <span class="keyword">as</span> ‘RECOVERED_FILES/path’.</div><div class="line">–<span class="keyword">restore</span>-files ‘path’ Will <span class="keyword">restore</span> files which <span class="keyword">are</span> listed <span class="keyword">in</span> the file ‘path’.</div><div class="line"><span class="keyword">Each</span> filename should be <span class="keyword">in</span> the same <span class="keyword">format</span> <span class="keyword">as</span> an <span class="keyword">option</span></div><div class="line"><span class="keyword">to</span> –<span class="keyword">restore</span>-file, <span class="keyword">and</span> there should be one per line.</div><div class="line">–<span class="keyword">restore</span>-directory ‘path’</div><div class="line">Will <span class="keyword">restore</span> directory ‘path’. ‘path’ <span class="keyword">is</span> <span class="keyword">relative</span> <span class="keyword">to</span> the</div><div class="line">root directory <span class="keyword">of</span> the file system. The restored</div><div class="line">directory <span class="keyword">is</span> created <span class="keyword">in</span> the <span class="keyword">output</span> directory <span class="keyword">as</span> ‘path’.</div><div class="line">–<span class="keyword">restore</span>-<span class="keyword">all</span> Attempts <span class="keyword">to</span> <span class="keyword">restore</span> everything.</div><div class="line">-j journal Reads an <span class="keyword">external</span> journal <span class="keyword">from</span> the named file.</div><div class="line">-b blocknumber Uses the <span class="keyword">backup</span> superblock <span class="keyword">at</span> blocknumber <span class="keyword">when</span> opening</div><div class="line">the file system.</div><div class="line">-B blocksize Uses blocksize <span class="keyword">as</span> the block <span class="keyword">size</span> <span class="keyword">when</span> opening the file</div><div class="line">system. The <span class="built_in">number</span> should be the <span class="built_in">number</span> <span class="keyword">of</span> bytes.</div><div class="line">–<span class="keyword">log</span> <span class="number">0</span> Make the program silent.</div><div class="line">–<span class="keyword">log</span> filename <span class="keyword">Logs</span> <span class="keyword">all</span> messages <span class="keyword">to</span> filename.</div><div class="line">–<span class="keyword">log</span> D1=<span class="number">0</span>,D2=filename Custom control <span class="keyword">of</span> <span class="keyword">log</span> messages <span class="keyword">with</span> comma-separated</div><div class="line">Examples below: list <span class="keyword">of</span> options. Dn must be one <span class="keyword">of</span> info, warn, <span class="keyword">or</span></div><div class="line">–<span class="keyword">log</span> info,error error. Omission <span class="keyword">of</span> the ‘=name’ results <span class="keyword">in</span> messages</div><div class="line">–<span class="keyword">log</span> warn=<span class="number">0</span> <span class="keyword">with</span> the specified <span class="keyword">level</span> <span class="keyword">to</span> be logged <span class="keyword">to</span> the console.</div><div class="line">–<span class="keyword">log</span> error=filename <span class="keyword">If</span> the parameter <span class="keyword">is</span> ‘=<span class="number">0</span>′, logging <span class="keyword">for</span> the specified</div><div class="line"><span class="keyword">level</span> will be turned off. <span class="keyword">If</span> the parameter <span class="keyword">is</span></div><div class="line">‘=filename’, messages <span class="keyword">with</span> that <span class="keyword">level</span> will be written</div><div class="line"><span class="keyword">to</span> filename.</div><div class="line">-o directory Save the recovered files <span class="keyword">to</span> the named directory.</div><div class="line">The restored files <span class="keyword">are</span> created <span class="keyword">in</span> a directory</div><div class="line">named ‘RECOVERED_FILES/’ <span class="keyword">by</span> <span class="keyword">default</span>.</div><div class="line">./extundelete: Error parsing command-line options.</div><div class="line">[root@hs12 src]# ./extundelete /dev/sdb1 –<span class="keyword">restore</span>-directory /<span class="keyword">data</span>/sh</div><div class="line">NOTICE: <span class="keyword">Extended</span> attributes <span class="keyword">are</span> <span class="keyword">not</span> restored.</div><div class="line">Loading filesystem metadata … <span class="number">29800</span> groups loaded.</div><div class="line">Loading journal descriptors … <span class="number">28266</span> descriptors loaded.</div><div class="line">Failed <span class="keyword">to</span> <span class="keyword">restore</span> file /<span class="keyword">data</span>/sh</div><div class="line">Could <span class="keyword">not</span> find correct inode <span class="built_in">number</span> past inode <span class="number">2.</span></div><div class="line">Try altering the filename <span class="keyword">to</span> one <span class="keyword">of</span> the entries listed below.</div><div class="line">File name | Inode <span class="built_in">number</span> | Deleted <span class="keyword">status</span></div><div class="line">. <span class="number">2</span></div><div class="line">.. <span class="number">2</span></div><div class="line">lost+<span class="keyword">found</span> <span class="number">11</span></div><div class="line"><span class="keyword">logs</span> <span class="number">195821569</span></div><div class="line">dfs <span class="number">14942209</span></div><div class="line">mapred <span class="number">165806081</span></div><div class="line">bidata <span class="number">221380609</span></div><div class="line">userdata <span class="number">3407873</span></div><div class="line">trackdata <span class="number">112459777</span></div><div class="line">adsdkdata <span class="number">135135233</span></div><div class="line">test <span class="number">227409921</span></div><div class="line">a.tar.gz <span class="number">12</span></div><div class="line">t1 <span class="number">13</span> Deleted</div><div class="line">test1 <span class="number">227278849</span></div><div class="line">statis <span class="number">109051905</span></div><div class="line">sh <span class="number">24641537</span></div><div class="line">hadoop <span class="number">59506689</span></div><div class="line">./extundelete: Operation <span class="keyword">not</span> permitted while restoring directory.</div><div class="line">./extundelete: Operation <span class="keyword">not</span> permitted <span class="keyword">when</span> trying <span class="keyword">to</span> examine filesystem</div><div class="line">[root@hs12 src]# ./extundelete /dev/sdb1 –<span class="keyword">restore</span>-file /<span class="keyword">data</span>/sh/active.awk</div><div class="line">NOTICE: <span class="keyword">Extended</span> attributes <span class="keyword">are</span> <span class="keyword">not</span> restored.</div><div class="line">Loading filesystem metadata … <span class="number">29800</span> groups loaded.</div><div class="line">Loading journal descriptors … <span class="number">28266</span> descriptors loaded.</div><div class="line">Failed <span class="keyword">to</span> <span class="keyword">restore</span> file /<span class="keyword">data</span>/sh/active.awk</div><div class="line">Could <span class="keyword">not</span> find correct inode <span class="built_in">number</span> past inode <span class="number">2.</span></div><div class="line">Try altering the filename <span class="keyword">to</span> one <span class="keyword">of</span> the entries listed below.</div><div class="line">File name | Inode <span class="built_in">number</span> | Deleted <span class="keyword">status</span></div><div class="line">. <span class="number">2</span></div><div class="line">.. <span class="number">2</span></div><div class="line">lost+<span class="keyword">found</span> <span class="number">11</span></div><div class="line"><span class="keyword">logs</span> <span class="number">195821569</span></div><div class="line">dfs <span class="number">14942209</span></div><div class="line">mapred <span class="number">165806081</span></div><div class="line">bidata <span class="number">221380609</span></div><div class="line">userdata <span class="number">3407873</span></div><div class="line">trackdata <span class="number">112459777</span></div><div class="line">adsdkdata <span class="number">135135233</span></div><div class="line">test <span class="number">227409921</span></div><div class="line">a.tar.gz <span class="number">12</span></div><div class="line">t1 <span class="number">13</span> Deleted</div><div class="line">test1 <span class="number">227278849</span></div><div class="line">statis <span class="number">109051905</span></div><div class="line">sh <span class="number">24641537</span></div><div class="line">hadoop <span class="number">59506689</span></div><div class="line">./extundelete: Operation <span class="keyword">not</span> permitted while restoring file.</div><div class="line">./extundelete: Operation <span class="keyword">not</span> permitted <span class="keyword">when</span> trying <span class="keyword">to</span> examine filesystem</div><div class="line">[root@hs12 RECOVERED_FILES]# ../extundelete /dev/sdb1 –<span class="keyword">restore</span>-<span class="keyword">all</span></div><div class="line">NOTICE: <span class="keyword">Extended</span> attributes <span class="keyword">are</span> <span class="keyword">not</span> restored.</div><div class="line">Loading filesystem metadata … <span class="number">29800</span> groups loaded.</div><div class="line">Loading journal descriptors … <span class="number">28266</span> descriptors loaded.</div><div class="line">[root@hs12 RECOVERED_FILES]# cd RECOVERED_FILES/</div><div class="line">[root@hs12 RECOVERED_FILES]# cd sh</div><div class="line">[root@hs12 sh]# ls</div><div class="line"><span class="number">09081.</span>txt a bknewdev.awk charge.sh derby.<span class="keyword">log</span> hive2mysql.sh luan.awk newdev.awk so.awk</div><div class="line"><span class="number">0908.</span>txt active.awk b.txt charge.txt dvid_price.awk hiveactive.sh luandoutang_09_900037.csv newdev.sh t.awk</div><div class="line"><span class="number">09.</span>txt active.sh charge cid_price.awk emptycid hivenewdev.sh luan.sh pid.awk TempStatsStore</div><div class="line"><span class="number">100001</span> adsdkdata charge_2013-<span class="number">09</span>-<span class="number">09.</span>txt cps err.txt hiveput.sh multidate.sh pid.sh test.awk</div><div class="line"><span class="number">1</span>dev.awk a.txt charge_20130909_.txt cps_newdev.java getdvid.awk insdata.py newdev print <span class="keyword">user</span>.awk</div><div class="line"><span class="number">201309081.</span>txt bi.awk charge2mysql.sh cps.sh getmysql.sh luan newdev1.awk py</div><div class="line"><span class="number">201309091.</span>txt bkactive.awk charge.awk dateutil.sh getnewdev_from_mysql.sh luan1 newdev2mysql.sh sendmail.sh</div><div class="line">[root@hs12 sh]# ls -l</div><div class="line">total <span class="number">225360</span></div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">29251633</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> <span class="number">09081.</span>txt</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">35249787</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> <span class="number">0908.</span>txt</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">64501420</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> <span class="number">09.</span>txt</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">2378</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> <span class="number">100001</span></div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">840</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> <span class="number">1</span>dev.awk</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">33931129</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> <span class="number">201309081.</span>txt</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">27169653</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> <span class="number">201309091.</span>txt</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">1</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> a</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">2227</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> active.awk</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">999</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> active.sh</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">19242484</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> adsdkdata</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">5626</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> a.txt</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">331</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> bi.awk</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">1543</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> bkactive.awk</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">931</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> bknewdev.awk</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">11</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> b.txt</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">230</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> charge</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">20964603</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> charge_2013-<span class="number">09</span>-<span class="number">09.</span>txt</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">229</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> charge_20130909_.txt</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">1243</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> charge2mysql.sh</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">428</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> charge.awk</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">2822</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> charge.sh</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">227</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> charge.txt</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">1227</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> cid_price.awk</div><div class="line">drwxr-xr-x <span class="number">2</span> root root <span class="number">4096</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> cps</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">12070</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> cps_newdev.java</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">2764</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> cps.sh</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">885</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> dateutil.sh</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">992</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> derby.<span class="keyword">log</span></div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">658</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> dvid_price.awk</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">54217</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> emptycid</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">64279</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> err.txt</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">379</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> getdvid.awk</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">1217</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> getmysql.sh</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">1552</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> getnewdev_from_mysql.sh</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">532</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> hive2mysql.sh</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">858</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> hiveactive.sh</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">926</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> hivenewdev.sh</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">683</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> hiveput.sh</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">2227</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> insdata.py</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">1045</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> luan</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">813</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> luan1</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">336</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> luan.awk</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">72909</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> luandoutang_09_900037.csv</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">180</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> luan.sh</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">420</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> multidate.sh</div><div class="line">drwxr-xr-x <span class="number">2</span> root root <span class="number">4096</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> newdev</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">777</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> newdev1.awk</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">1290</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> newdev2mysql.sh</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">738</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> newdev.awk</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">762</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> newdev.sh</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">693</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> pid.awk</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">518</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> pid.sh</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">99</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> print</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">30324</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> py</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">160</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> sendmail.sh</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">744</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> so.awk</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">93</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> t.awk</div><div class="line">drwxr-xr-x <span class="number">2</span> root root <span class="number">4096</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> TempStatsStore</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">311</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> test.awk</div><div class="line">-rw-r–r– <span class="number">1</span> root root <span class="number">385</span> Sep <span class="number">12</span> <span class="number">19</span>:<span class="number">46</span> <span class="keyword">user</span>.awk</div><div class="line">[root@hs12 sh]# vi active.awk</div></pre></td></tr></table></figure>

<p>查看，脚本都在。</p>
<h3 id="整个恢复成功。">整个恢复成功。</h3>
<p>所以唯一成功的是extundelete ,并且不能指定文件和目录，而是全部恢复，才能成功。<br>一块石头落了地：）<br>经验提供给后来者，一定要备份，磁盘要功能分区。rm命令要 alias rm=”rm -i”.</p>

        

      </div>
    

    
      <div class="post-footer">
        
          <div class="post-tags">
            
              <a href="/tags/文件恢复/">
                #文件恢复
              </a>
            
          </div>
        

        

        
      </div>
    
  </div>



  
    
  

          </div>

          
        </div>

        
<div class="sidebar-toggle">
  <div class="sidebar-toggle-line-wrap">
    <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
    <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
    <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
  </div>
</div>

<div id="sidebar" class="sidebar">
  <div class="sidebar-inner">

    
      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-overview" data-target="site-overview">
          Overview
        </li>
        <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc">
          Table Of Contents
        </li>
      </ul>
    

    <div class="site-overview">
      <div class="site-author motion-element">
        <img class="site-author-image" src="/images/default_avatar.jpg" alt="snom" />
        <p class="site-author-name">snom</p>
      </div>
      <p class="site-description motion-element">本博客主要用来记录linux相关的文章</p>
      <div class="site-state motion-element">
        <div class="site-state-item site-state-posts">
          <span class="site-state-item-count">21</span>
          <span class="site-state-item-name">posts</span>
        </div>
        <div class="site-state-item site-state-tags">
            <span class="site-state-item-count">27</span>
            <span class="site-state-item-name">tags</span>
        </div>
        <div class="site-state-item site-state-pages">
            <span class="site-state-item-count">5</span>
            <span class="site-state-item-name">pages</span>
        </div>
      </div>

      

      <div class="social-info motion-element">
        
      </div>

    </div>

    
      <div class="post-toc sidebar-panel-active">
        <ol class="motion-element"><li class="motion-element-item motion-element-level-3"><a class="motion-element-link" href="#首先，需立即将磁盘挂载为只读。"><span class="motion-element-number">1.</span> <span class="motion-element-text">首先，需立即将磁盘挂载为只读。</span></a><ol class="motion-element-child"><li class="motion-element-item motion-element-level-4"><a class="motion-element-link" href="#/data挂在/dev/sdb1上"><span class="motion-element-number">1.1.</span> <span class="motion-element-text">/data挂在/dev/sdb1上</span></a></li><li class="motion-element-item motion-element-level-4"><a class="motion-element-link" href="#这需看看有哪些进程在用："><span class="motion-element-number">1.2.</span> <span class="motion-element-text">这需看看有哪些进程在用：</span></a></li><li class="motion-element-item motion-element-level-4"><a class="motion-element-link" href="#可以看到有很多java和hadoop进程在使用，杀之。"><span class="motion-element-number">1.3.</span> <span class="motion-element-text">可以看到有很多java和hadoop进程在使用，杀之。</span></a></li><li class="motion-element-item motion-element-level-4"><a class="motion-element-link" href="#再到/data里touch文件，报错。"><span class="motion-element-number">1.4.</span> <span class="motion-element-text">再到/data里touch文件，报错。</span></a></li></ol></li><li class="motion-element-item motion-element-level-3"><a class="motion-element-link" href="#使用debugfs"><span class="motion-element-number">2.</span> <span class="motion-element-text">使用debugfs</span></a><ol class="motion-element-child"><li class="motion-element-item motion-element-level-4"><a class="motion-element-link" href="#用debugfs查找被删文件的inode，再想法恢复。"><span class="motion-element-number">2.1.</span> <span class="motion-element-text">用debugfs查找被删文件的inode，再想法恢复。</span></a></li></ol></li><li class="motion-element-item motion-element-level-3"><a class="motion-element-link" href="#使用grep恢复"><span class="motion-element-number">3.</span> <span class="motion-element-text">使用grep恢复</span></a></li><li class="motion-element-item motion-element-level-3"><a class="motion-element-link" href="#使用ext3grep"><span class="motion-element-number">4.</span> <span class="motion-element-text">使用ext3grep</span></a></li><li class="motion-element-item motion-element-level-3"><a class="motion-element-link" href="#用testdisk_6-14"><span class="motion-element-number">5.</span> <span class="motion-element-text">用testdisk 6.14</span></a><ol class="motion-element-child"><li class="motion-element-item motion-element-level-4"><a class="motion-element-link" href="#使用介绍："><span class="motion-element-number">5.1.</span> <span class="motion-element-text">使用介绍：</span></a></li><li class="motion-element-item motion-element-level-4"><a class="motion-element-link" href="#下载："><span class="motion-element-number">5.2.</span> <span class="motion-element-text">下载：</span></a></li><li class="motion-element-item motion-element-level-4"><a class="motion-element-link" href="#执行命令"><span class="motion-element-number">5.3.</span> <span class="motion-element-text">执行命令</span></a></li><li class="motion-element-item motion-element-level-4"><a class="motion-element-link" href="#选到相应目录，enter，终于看到了删除的文件名，但是文件大小怎么都是0啊？"><span class="motion-element-number">5.4.</span> <span class="motion-element-text">选到相应目录，enter，终于看到了删除的文件名，但是文件大小怎么都是0啊？</span></a></li></ol></li><li class="motion-element-item motion-element-level-3"><a class="motion-element-link" href="#用extundelete-0-2-4恢复"><span class="motion-element-number">6.</span> <span class="motion-element-text">用extundelete-0.2.4恢复</span></a><ol class="motion-element-child"><li class="motion-element-item motion-element-level-4"><a class="motion-element-link" href="#官方网站："><span class="motion-element-number">6.1.</span> <span class="motion-element-text">官方网站：</span></a></li><li class="motion-element-item motion-element-level-4"><a class="motion-element-link" href="#下载：-1"><span class="motion-element-number">6.2.</span> <span class="motion-element-text">下载：</span></a></li></ol></li><li class="motion-element-item motion-element-level-3"><a class="motion-element-link" href="#整个恢复成功。"><span class="motion-element-number">7.</span> <span class="motion-element-text">整个恢复成功。</span></a></li></ol>
      </div>
    
  </div>
</div>


      </div>
    </div>

    <div id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; &nbsp; 
  2015
  <span class="with-love">
    <i class="icon-heart"></i>
  </span>
  <span class="author">snom</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme - <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT</a>
</div>





      </div>
    </div>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/dist/jquery.min.js?v=0.3.0rc2"></script>
  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript">
    $(document).ready(function() {
      $(".fancybox").fancybox();
    });
  </script>



  

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  

  <script type="text/javascript">
    $(document).ready(function () {
      var body = $('body');
      var isSidebarVisible = false;
      var sidebarToggle = $('.sidebar-toggle');
      var sidebarToggleLine1st = $('.sidebar-toggle-line-first')
      var sidebarToggleLine2nd = $('.sidebar-toggle-line-middle');
      var sidebarToggleLine3rd = $('.sidebar-toggle-line-last');
      var sidebar = $('.sidebar');

      var sidebarToogleLineStatusInit = {width: '100%', opacity: 1, left: 0, rotateZ: 0, top: 0};

      var sidebarToggleLine1stStatusInit = sidebarToogleLineStatusInit;
      var sidebarToggleLine1stStatusArrow = {width: '50%', rotateZ: '-45deg', top: '2px'};
      var sidebarToogleLine1stStatusClose = {width: '100%', rotateZ: '-45deg', top: '5px'};

      var sidebarToggleLine2ndStatusInit = sidebarToogleLineStatusInit;
      var sidebarToggleLine2ndStatusArrow = {width: '90%'};
      var sidebarToogleLine2ndStatusClose = {opacity: 0};

      var sidebarToggleLine3rdStatusInit = sidebarToogleLineStatusInit;
      var sidebarToggleLine3rdStatusArrow = {width: '50%', rotateZ: '45deg', top: '-2px'};
      var sidebarToogleLine3rdStatusClose = {width: '100%', rotateZ: '45deg', top: '-5px'};

      sidebatToggleMotion();
      postsListMotion();
      backToTopMotion();

      function sidebarContentMotion () {
        $('.sidebar .motion-element').velocity(
          'transition.slideRightIn',
          {stagger: 50, drag: true}
        );
      }


      function backToTopMotion () {
        var b2top = $('.back-to-top');
        b2top.on('click', function () {
          body.velocity('scroll');
        });
      }

      function sidebarShowMotion () {
        var sidebarDisplayDuration = 300;
        var sidebarWidth = '320px';

        sidebarToggleLine1st.velocity(sidebarToogleLine1stStatusClose);
        sidebarToggleLine2nd.velocity(sidebarToogleLine2ndStatusClose);
        sidebarToggleLine3rd.velocity(sidebarToogleLine3rdStatusClose);

        sidebar.velocity({width: sidebarWidth}, sidebarDisplayDuration);
        isDesktop() && body.velocity({paddingRight: sidebarWidth}, sidebarDisplayDuration);
        sidebarContentMotion();
      }

      function sidebarHideMotion () {
        isDesktop() && body.velocity({paddingRight: 0});
        sidebar.velocity('reverse');

        sidebarToggleLine1st.velocity(sidebarToggleLine1stStatusInit);
        sidebarToggleLine2nd.velocity(sidebarToggleLine2ndStatusInit);
        sidebarToggleLine3rd.velocity(sidebarToggleLine3rdStatusInit);
      };

      function postsListMotion () {
        $('.post').velocity('transition.slideDownIn', {stagger: 300, drag: true});
      }

      function sidebatToggleMotion () {
        sidebarToggle.on('click', function () {
          isSidebarVisible ? sidebarHideMotion() : sidebarShowMotion();
          isSidebarVisible = !isSidebarVisible;
        });
        sidebarToggle.hover(function () {
          if (isSidebarVisible) {return}
          sidebarToggleLine1st.velocity('stop').velocity(sidebarToggleLine1stStatusArrow);
          sidebarToggleLine2nd.velocity('stop').velocity(sidebarToggleLine2ndStatusArrow);
          sidebarToggleLine3rd.velocity('stop').velocity(sidebarToggleLine3rdStatusArrow);
        }, function () {
          if (isSidebarVisible) {return}
          sidebarToggleLine1st.velocity('stop').velocity(sidebarToggleLine1stStatusInit);
          sidebarToggleLine2nd.velocity('stop').velocity(sidebarToggleLine2ndStatusInit);
          sidebarToggleLine3rd.velocity('stop').velocity(sidebarToggleLine3rdStatusInit);
        });
      }

      function isDesktop () {
        return screen.width > 991;
      }

      function isTablet () {
        return screen.width < 992 && screen.width > 767;
      }

      function isMobile () {
        return screen.width < 767;
      }
    });
  </script>

  

  
  
    <script type="text/javascript">
      $(document).ready(function () {
        var html = $('html');

        $('.sidebar-nav li').on('click', function () {
          var item = $(this);
          var activeTabClassName = 'sidebar-nav-active';
          var activePanelClassName = 'sidebar-panel-active';
          if (item.hasClass(activeTabClassName)) {
            return;
          }

          var currentTarget = $('.' + activePanelClassName);
          var target = $('.' + item.data('target'));

          currentTarget.velocity('transition.slideUpOut', 200, function () {
            target
              .velocity('stop')
              .velocity('transition.slideDownIn', 200)
              .addClass(activePanelClassName);
          });
          
          item.siblings().removeClass(activeTabClassName);
          item.addClass(activeTabClassName);
        });

        $('.post-toc a').on('click', function (e) {
          e.preventDefault();
          var offset = $(this.getAttribute('href')).offset().top;
          html.velocity('stop').velocity('scroll', {
            offset: offset  + 'px',
            mobileHA: false
          });
        });
      });
    </script>
  


  

  
  

  


  
</body>
</html>
